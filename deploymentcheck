pipeline {
  
  agent any

  
  stages {
    

   stage('Docker Deploy') {
            steps {
                script {
                    def ansiblePlaybookContent = '''
                    - hosts: dockeradmin
                      become: True
                    


                      tasks:
                        - name: Install python pip
                          yum:
                            name: python-pip
                            state: present

                        - name: Install docker-py python module
                          pip:
                            name: docker-py
                            state: present

                        - name: Start the container
                          docker_container:
                            name: nodecontainer
                            image: "ameerbatcha/nodeapp:0213425"
                            state: started
                            published_ports:
                              - 0.0.0.0:8081:80
                    '''

                    writeFile(file: 'inline_playbook.yml', text: ansiblePlaybookContent)

                   def ansibleInventoryContent = '''[dockeradmin]
                   172.31.14.59 ansible_user=${SSH_USERNAME}
                    '''

                    writeFile(file: 'dev.inv', text: ansibleInventoryContent)

   
                 

                  ansiblePlaybook(
                                 inventory: 'dev.inv',
                                 playbook: 'inline_playbook.yml',
                                 credentialsId: 'dev-dockerhost',
                                 installation: 'ansible',
                               
                              
)

                
              }
            }
        }

    }


  
}




    
   

    
